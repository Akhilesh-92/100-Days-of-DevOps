# Day 93: Using Ansible Conditions

The Nautilus DevOps team had a discussion about, how they can train different team members to use Ansible for different automation tasks. There are numerous ways to perform a particular task using Ansible, but we want to utilize each aspect that Ansible offers. The team wants to utilise Ansible's conditionals to perform the following task:

An inventory file is already placed under `/home/thor/ansible` directory on jump host, with all the Stratos DC app servers included.

Create a playbook `/home/thor/ansible/playbook.yml` and make sure to use Ansible's when conditionals statements to perform the below given tasks.

1. Copy `blog.txt` file present under `/usr/src/dba` directory on jump host to `App Server 1` under `/opt/dba` directory. Its user and group owner must be user `tony` and its permissions must be `0644`.

2. Copy `story.txt` file present under `/usr/src/dba` directory on jump host to `App Server 2` under `/opt/dba` directory. Its user and group owner must be user `steve` and its permissions must be `0644` .

3. Copy `media.txt` file present under `/usr/src/dba` directory on jump host to `App Server 3` under `/opt/dba` directory. Its user and group owner must be user `banner` and its permissions must be `0644`.

> NOTE:

- You can use `ansible_nodename` variable from gathered facts with when condition. Additionally, please make sure you are running the play for all hosts i.e use - hosts: all.

- Validation will try to run the playbook using command `ansible-playbook -i inventory playbook.yml`, so please make sure the playbook works this way without passing any extra arguments.


## Solution
1. Add playbook contents as below
```
---
- name: Copy different files to different servers
  hosts: all
  gather_facts: yes
  become: yes

  vars:
    file_copy_map:
      stapp01:
        src: /usr/src/dba/blog.txt
        dest: /opt/dba
        owner: "tony"
        group: "tony"
        mode: '0644'

      stapp02:
        src: /usr/src/dba/story.txt
        dest: /opt/dba
        owner: "steve"
        group: "steve"
        mode: '0644'

      stapp03:
        src: /usr/src/dba/media.txt
        dest: /opt/dba
        owner: "banner"
        group: "banner"
        mode: '0644'

  tasks:

    - name: Copy file based on hostname using when condition
      copy:
        src: "{{ item.value.src }}"
        dest: "{{ item.value.dest }}"
        owner: "{{ item.value.owner }}"
        group: "{{ item.value.group }}"
        mode: "{{ item.value.mode }}"
      loop: "{{ file_copy_map | dict2items }}"
      when: item.key | lower == ansible_hostname | lower
```

2. Execute the playbook command
```
ansible-playbook -i inventory playbook.yml`
```

3. Verify by logging into each app server and run below command
```
ls -la /opt/dba
```
