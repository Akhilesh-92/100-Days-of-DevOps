# Day 61: Init Containers in Kubernetes

There are some applications that need to be deployed on Kubernetes cluster and these apps have some pre-requisites where some configurations need to be changed before deploying the app container. Some of these changes cannot be made inside the images so the DevOps team has come up with a solution to use init containers to perform these tasks during deployment. Below is a sample scenario that the team is going to test first.

* Create a Deployment named as `ic-deploy-nautilus`.

* Configure spec as `replicas` should be `3`, labels app should be `ic-nautilus`, template's metadata lables `app` should be the same `ic-nautilus`.

* The initContainers should be named as `ic-msg-nautilus`, use image `debian` with latest tag and use command `'/bin/bash', '-c' and 'echo Init Done - Welcome to xFusionCorp Industries > /ic/media'`. The volume mount should be named as `ic-volume-nautilus` and mount path should be `/ic`.

* Main container should be named as `ic-main-nautilus`, use image `debian` with latest tag and use command `'/bin/bash', '-c' and 'while true; do cat /ic/media; sleep 5; done'`. The volume mount should be named as `ic-volume-nautilus` and mount path should be `/ic`.

* Volume to be named as `ic-volume-nautilus` and it should be an `emptyDir` type.

> Note: The kubectl utility on jump_host has been configured to work with the kubernetes cluster.



## Solution
1. On jump host, create a dep.yaml like below
```sh
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ic-deploy-nautilus
  labels:
    app: ic-nautilus
spec:
  replicas: 3
  selector:
    matchLabels:
      app: ic-nautilus
  template:
    metadata:
      labels:
        app: ic-nautilus
    spec:
      initContainers:
      - name: ic-msg-nautilus
        image: debian:latest
        command: ["/bin/bash", "-c", "echo 'Init Done - Welcome to xFusionCorp Industries' > /ic/media"]
        volumeMounts:
        - name: ic-volume-nautilus
          mountPath: /ic
        resources:
          limits:
            cpu: 250m
            memory: 256Mi
          requests:
            cpu: 100m
            memory: 128Mi
      containers:
      - name: ic-main-nautilus
        image: debian:latest
        command: ["/bin/bash", "-c", 'while true; do cat /ic/media; sleep 5; done']
        volumeMounts:
        - name: ic-volume-nautilus
          mountPath: /ic
        resources:
          limits:
            cpu: 250m
            memory: 256Mi
          requests:
            cpu: 100m
            memory: 128Mi
      volumes:
        - name: ic-volume-nautilus
          emptyDir: {}
```

2. Create a deployemnt using above yaml file
```sh
kubectl apply -f dep.yaml
```


3. Verify the deployment creation
```sh
kubectl get deploy
kubectl get pods
```
